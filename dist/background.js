(()=>{"use strict";const t=["www.reddit.com","www.dr.dk","tv2.dk","sport.tv2.dk","nyheder.tv2.dk","vejr.tv2.dk","tv.tv2.dk","ekstrabladet.dk","politiken.dk","www.bt.dk","jp.dk","jyllands-posten.dk","www.berlingske.dk","msn.dk","www.msn.com","finans.dk","www.dagens.dk","www.dagens.com","www.seoghoer.dk","www.lokalavisen.dk","dinavis.dk","www.nytimes.com","people.com","www.bbc.co.uk","www.bbc.com","www.foxnews.com","cnn.com","edition.cnn.com","news.google.com","www.yahoo.com","www.theguardian.com","www.dailymail.co.uk"];var e=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}u((o=o.apply(t,e||[])).next())}))};function n(){return e(this,void 0,void 0,(function*(){return(yield c("targets"))||[]}))}function o(){return e(this,void 0,void 0,(function*(){const t=yield i();if(!t)return;const e=new URL(t.url);if(!(null==e?void 0:e.hostname))return;const n=e.hostname;return((yield c("excludedDomains"))||[]).includes(n)}))}function i(){return e(this,void 0,void 0,(function*(){return(yield chrome.tabs.query({active:!0}))[0]||null}))}function r(t){return e(this,void 0,void 0,(function*(){return yield chrome.storage.local.set({excludedDomains:t}),{result:!0}}))}function s(){return e(this,void 0,void 0,(function*(){const t=yield i();t&&chrome.tabs.sendMessage(t.id,{type:"REINIT_BLOCKING"},(t=>{chrome.runtime.lastError}))}))}function c(t){return e(this,void 0,void 0,(function*(){return new Promise((e=>{chrome.storage.local.get([t],(n=>{e(n[t])}))}))}))}chrome.runtime.onMessage.addListener(((u,d,l)=>{const{type:a,data:h}=u;return"GET_TARGETS"===a?n().then((t=>l(t))):"ADD_TARGET"===a?function(t){return e(this,void 0,void 0,(function*(){const{ignoreCase:e,removeBlock:o,target:i}=t,r=function(t){const{ignoreCase:e,removeBlock:n,webResourceKey:o,target:i}=t,r=o+(e?i.toLowerCase():i)+(n?"1":"0");return r}(t),u=(yield c("targets"))||[],d=u.find((t=>t.id===r));if(d)return{success:!1};u.push({id:r,key:r,target:i,ignoreCase:e,removeBlock:o}),yield chrome.storage.local.set({targets:u});const l=yield n();return s(),{success:!0,data:l}}))}(h).then((t=>l(t))):"DELETE_TARGET_ITEM"===a?function(t){return e(this,void 0,void 0,(function*(){const{id:e}=t,o=(yield c("targets"))||[];if(!o.find((t=>t.id===e)))return{success:!1};const i=o.filter((t=>t.id!==e));yield chrome.storage.local.set({targets:i});return{success:!0,data:yield n()}}))}(h).then((t=>l(t))):"SET_IS_BLOCKING"===a?function(t){return e(this,void 0,void 0,(function*(){const{isBlocking:e}=t;return void 0===e?{result:!1}:(yield chrome.storage.local.set({isBlocking:e}),s(),{result:!0})}))}(h).then((t=>l(t))):"GET_IS_BLOCKING"===a?function(){return e(this,void 0,void 0,(function*(){const t=(yield c("isBlocking"))||!1,e=yield o();return t&&!e||!1}))}().then((t=>l(t))):"GET_IS_DEFAULT_CAN_BE_BLOCKING"===a?function(){return e(this,void 0,void 0,(function*(){var e;const n=yield chrome.tabs.query({active:!0,currentWindow:!0});if(!(null===(e=n[0])||void 0===e?void 0:e.url))return;const o=new URL(n[0].url);if(!(null==o?void 0:o.hostname))return;const i=o.hostname;return!t.includes(i)}))}().then((t=>l(t))):"CHECK_TAB_ACTIVE"===a?l(null===d.tab.id):"GET_EXCLUDED_DOMAINS"===a?function(){return e(this,void 0,void 0,(function*(){return(yield c("excludedDomains"))||[]}))}().then((t=>l(t))):"SET_EXCLUDED_DOMAINS"===a?r(h).then((t=>l(t))):"GET_IS_ACTIVE_TAB_DOMAIN_IN_EXCLUDED_DOMAINS"===a?o().then((t=>l(t))):"ADD_CURRENT_DOMAIN_TO_EXCLUDED_DOMAINS"===a?function(){return e(this,void 0,void 0,(function*(){const t=yield i();if(!t)return{result:!1};const e=new URL(t.url);if(!(null==e?void 0:e.hostname))return{result:!1};const n=e.hostname,o=(yield c("excludedDomains"))||[];return o.includes(n)?{result:!1}:(o.push(n),yield r(o),{result:!0})}))}().then((t=>l(t))):"REMOVE_CURRENT_DOMAIN_FROM_EXCLUDED_DOMAINS"===a?function(){return e(this,void 0,void 0,(function*(){const t=yield i();if(!t)return{result:!1};const e=new URL(t.url);if(!(null==e?void 0:e.hostname))return{result:!1};const n=e.hostname,o=(yield c("excludedDomains"))||[];return o.includes(n)?(o.splice(o.indexOf(n),1),yield r(o),{result:!0}):{result:!1}}))}().then((t=>l(t))):"REINIT_BLOCKING"===a?s().then((t=>l(t))):"SET_STYLE"===a?function(t){return e(this,void 0,void 0,(function*(){t&&(yield chrome.storage.local.set({style:t}),s())}))}(h).then((t=>l(t))):"GET_STYLE"===a&&function(){return e(this,void 0,void 0,(function*(){return(yield c("style"))||"on"}))}().then((t=>l(t))),!0})),chrome.tabs.onActivated.addListener((t=>e(void 0,void 0,void 0,(function*(){try{const e=yield chrome.tabs.get(t.tabId);if(!e.url||e.url.startsWith("chrome://"))return;s()}catch(t){}}))))})();