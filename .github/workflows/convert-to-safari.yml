name: Convert Chrome Extension to Safari

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Convert Chrome extension to Safari
        run: |
          echo "Checking dist directory..."
          if [ -d "dist" ]; then
            echo "Running converter..."
            safari-web-extension-converter dist \
              --output safari_extension \
              --no-open \
              --force
          else
            echo "The 'dist' directory is missing!"
            exit 1
          fi

      - name: Archive Safari extension
        run: |
          cd safari_extension
          zip -r safari_extension.zip .
          echo "safari_extension_zip=$(pwd)/safari_extension.zip" >> $GITHUB_ENV

      - name: Upload Safari extension as artifact
        uses: actions/upload-artifact@v4
        with:
          name: safari-extension
          path: ${{ env.safari_extension_zip }}
